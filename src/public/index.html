<!DOCTYPE html>
<html lang="it" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Database Torrent Crawler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .provider-badge { font-size: 0.8em; opacity: 0.8; }
        .hash { font-family: monospace; font-size: 0.8em; color: #aaa; }
    </style>
</head>
<body class="bg-dark text-light p-4">
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card bg-secondary text-white">
                    <div class="card-body">
                        <h5>Torrent Totali</h5>
                        <h2 id="totalTorrents">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-secondary text-white">
                    <div class="card-body">
                        <h5>Solo Serie TV</h5>
                        <h2 id="seriesCount">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h5>Seeders Totali</h5>
                        <h2 id="totalSeeders">-</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="card bg-dark border-secondary">
            <div class="card-header border-secondary">Ultimi Torrent Aggiunti</div>
            <div class="card-body p-0">
                <table class="table table-dark table-hover table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Titolo</th>
                            <th>Info</th>
                            <th>Seeders</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function formatBytes(bytes) {
            if (!bytes) return '-';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function update() {
            try {
                const res = await fetch('/api/data');
                const data = await res.json();
                
                document.getElementById('totalTorrents').innerText = data.stats.total_torrents;
                document.getElementById('seriesCount').innerText = data.stats.series_count;
                document.getElementById('totalSeeders').innerText = data.stats.total_seeders;

                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = data.torrents.map(t => `
                    <tr>
                        <td>
                            <div class="fw-bold text-info">${t.title}</div>
                            <span class="hash">${t.info_hash}</span>
                        </td>
                        <td>
                            <span class="badge bg-primary provider-badge">${t.provider}</span>
                            <span class="badge bg-secondary">${formatBytes(parseInt(t.size))}</span>
                        </td>
                        <td class="text-success fw-bold">${t.seeders}</td>
                        <td class="text-muted small">${new Date(t.upload_date).toLocaleString()}</td>
                    </tr>
                `).join('');
            } catch (e) { console.error(e); }
        }

        setInterval(update, 5000); // Aggiorna ogni 5 secondi
        update();
    </script>
</body>
</html>
